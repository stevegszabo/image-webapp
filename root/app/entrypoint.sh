#!/bin/bash

set -o errexit

PROFILE=/vault/secrets/config

if [ -f $PROFILE ]; then
    source $PROFILE
else
    POSTGRES_USER=user
    POSTGRES_PASSWORD=pass
    export POSTGRES_USER POSTGRES_PASSWORD
fi

WEBAPP_VERSION=${WEBAPP_VERSION-0000000}
WEBAPP_ADDRESS=${WEBAPP_ADDRESS-0.0.0.0}
WEBAPP_PORT=${WEBAPP_PORT-8080}
WEBAPP_LOG_LEVEL=${WEBAPP_LOG_LEVEL-debug}
WEBAPP_APPLICATION=${WEBAPP_APPLICATION-app.webapp:GAPPLICATION}

gunicorn3 --bind "$WEBAPP_ADDRESS:$WEBAPP_PORT" "$WEBAPP_APPLICATION" --log-level "$WEBAPP_LOG_LEVEL" --access-logfile - --error-logfile -

exit 0
